–ü–ê–ü–ö–ê CONFIG

=====================
FirebaseConfig.cs
=====================

using Firebase.Database;

namespace TrackingApp.Server.Config
{
    public static class FirebaseConfig
    {
        private static FirebaseClient _firebaseClient;
        private static bool _initialized = false;

        public static string DatabaseUrl { get; private set; }

        public static void Initialize()
        {
            if (_initialized) return;

            try
            {
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –≤–∞—à–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
                DatabaseUrl = "https://tracking-app-1bea8-default-rtdb.europe-west1.firebasedatabase.app/";

                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase Client –ë–ï–ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
                _firebaseClient = new FirebaseClient(DatabaseUrl);

                _initialized = true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase: {ex.Message}");
                throw;
            }
        }

        public static FirebaseClient GetClient()
        {
            if (!_initialized)
                throw new InvalidOperationException("Firebase –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ. –í–∏–∫–ª–∏—á—Ç–µ Initialize —Å–ø–æ—á–∞—Ç–∫—É.");

            return _firebaseClient;
        }
    }
}





========================
ServerConfig.cs
====================


namespace TrackingApp.Server.Config
{
    public static class ServerConfig
    {
        public static int Port { get; private set; } = 8888;
        public static int BufferSize { get; private set; } = 4096;

        public static void Initialize()
        {
            // –ú–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ—Ä—Ç —á–µ—Ä–µ–∑ –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
            var portEnv = Environment.GetEnvironmentVariable("TRACKING_SERVER_PORT");
            if (!string.IsNullOrEmpty(portEnv) && int.TryParse(portEnv, out int port))
            {
                Port = port;
            }
        }
    }
}




--------------------------------------------------------

–ü–ê–ü–ö–ê Models



====================
FirebaseModels.cs
=======================


using System.Text.Json.Serialization;

namespace TrackingApp.Server.Models
{
    public class Location
    {
        [JsonPropertyName("latitude")]
        public double Latitude { get; set; }

        [JsonPropertyName("longitude")]
        public double Longitude { get; set; }

        public Location() { }

        public Location(double lat, double lon)
        {
            Latitude = lat;
            Longitude = lon;
        }

        public override string ToString() => $"{Latitude:F5}, {Longitude:F5}";
    }

    public class User
    {
        [JsonPropertyName("id")]
        public string Id { get; set; } = Guid.NewGuid().ToString();

        [JsonPropertyName("name")]
        public string Name { get; set; } = string.Empty;

        [JsonPropertyName("email")]
        public string Email { get; set; } = string.Empty;

        [JsonPropertyName("password")]
        public string Password { get; set; } = string.Empty;

        [JsonPropertyName("currentLocation")]
        public Location CurrentLocation { get; set; } = new Location();

        [JsonPropertyName("isLeader")]
        public bool IsLeader { get; set; }

        [JsonPropertyName("status")]
        public UserStatus Status { get; set; }

        [JsonPropertyName("tripType")]
        public TripType TripType { get; set; }

        [JsonPropertyName("lastUpdated")]
        public DateTime LastUpdated { get; set; } = DateTime.UtcNow;
    }

    public enum UserStatus
    {
        None = 0,
        Help = 1,
        Stop = 2
    }

    public enum TripType
    {
        Walking = 0,
        Cycling = 1,
        Excursion = 2
    }

    public class Trip
    {
        [JsonPropertyName("tripName")]
        public string TripName { get; set; } = "Trip";

        [JsonPropertyName("route")]
        public List<Location> Route { get; set; } = new List<Location>();

        [JsonPropertyName("duration")]
        public string Duration { get; set; } = "3 –≥–æ–¥–∏–Ω–∏";

        [JsonPropertyName("breakSchedule")]
        public string BreakSchedule { get; set; } = "–ü–µ—Ä–µ—Ä–≤–∞ –∑ 12:00 –¥–æ 13:00";

        [JsonPropertyName("restPlaces")]
        public List<string> RestPlaces { get; set; } = new List<string>();

        [JsonPropertyName("pointsOfInterest")]
        public List<string> PointsOfInterest { get; set; } = new List<string>();

        [JsonPropertyName("isActive")]
        public bool IsActive { get; set; } = true;

        [JsonPropertyName("createdAt")]
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    }

    public class PredefinedTrip
    {
        [JsonPropertyName("id")]
        public string Id { get; set; } = Guid.NewGuid().ToString();

        [JsonPropertyName("name")]
        public string Name { get; set; } = string.Empty;

        [JsonPropertyName("description")]
        public string Description { get; set; } = string.Empty;

        [JsonPropertyName("route")]
        public List<Location> Route { get; set; } = new List<Location>();

        [JsonPropertyName("duration")]
        public string Duration { get; set; } = string.Empty;

        [JsonPropertyName("breakSchedule")]
        public string BreakSchedule { get; set; } = string.Empty;

        [JsonPropertyName("restPlaces")]
        public List<string> RestPlaces { get; set; } = new List<string>();

        [JsonPropertyName("pointsOfInterest")]
        public List<string> PointsOfInterest { get; set; } = new List<string>();

        [JsonPropertyName("createdAt")]
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        [JsonPropertyName("isActive")]
        public bool IsActive { get; set; }

        [JsonPropertyName("isPredefined")]
        public bool IsPredefined { get; set; } = true;
    }

    public class Notification
    {
        [JsonPropertyName("time")]
        public DateTime Time { get; set; } = DateTime.UtcNow;

        [JsonPropertyName("message")]
        public string Message { get; set; } = string.Empty;

        [JsonPropertyName("userId")]
        public string UserId { get; set; } = string.Empty;

        [JsonPropertyName("userName")]
        public string UserName { get; set; } = string.Empty;

        [JsonPropertyName("isRead")]
        public bool IsRead { get; set; }
    }

    public class Feedback
    {
        [JsonPropertyName("id")]
        public string Id { get; set; } = Guid.NewGuid().ToString();

        [JsonPropertyName("userId")]
        public string UserId { get; set; } = string.Empty;

        [JsonPropertyName("userName")]
        public string UserName { get; set; } = string.Empty;

        [JsonPropertyName("message")]
        public string Message { get; set; } = string.Empty;

        [JsonPropertyName("rating")]
        public int Rating { get; set; } = 5;

        [JsonPropertyName("createdAt")]
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        [JsonPropertyName("tripName")]
        public string TripName { get; set; } = string.Empty;
    }

    // –î–û–î–ê–ù–û: –ö–ª–∞—Å –¥–ª—è –ø–ª–∞–Ω—É –ø–æ–¥–æ—Ä–æ–∂—ñ
    public class TripPlan
    {
        [JsonPropertyName("id")]
        public string Id { get; set; } = Guid.NewGuid().ToString();

        [JsonPropertyName("tripId")]
        public string TripId { get; set; } = string.Empty;

        [JsonPropertyName("duration")]
        public string Duration { get; set; } = string.Empty;

        [JsonPropertyName("breakSchedule")]
        public string BreakSchedule { get; set; } = string.Empty;

        [JsonPropertyName("restPlaces")]
        public List<string> RestPlaces { get; set; } = new List<string>();

        [JsonPropertyName("pointsOfInterest")]
        public List<string> PointsOfInterest { get; set; } = new List<string>();

        [JsonPropertyName("lastUpdated")]
        public DateTime LastUpdated { get; set; } = DateTime.UtcNow;

        [JsonPropertyName("updatedBy")]
        public string UpdatedBy { get; set; } = string.Empty;
    }

    public class ApiResponse<T>
    {
        [JsonPropertyName("success")]
        public bool Success { get; set; }

        [JsonPropertyName("message")]
        public string Message { get; set; } = string.Empty;

        [JsonPropertyName("data")]
        public T Data { get; set; }

        [JsonPropertyName("errorCode")]
        public string ErrorCode { get; set; } = string.Empty;

        public static ApiResponse<T> SuccessResponse(T data, string message = "Success")
            => new ApiResponse<T> { Success = true, Message = message, Data = data };

        public static ApiResponse<T> ErrorResponse(string message, string errorCode = "")
            => new ApiResponse<T> { Success = false, Message = message, ErrorCode = errorCode };
    }

    public class ActiveTripData
    {
        [JsonPropertyName("tripId")]
        public string TripId { get; set; } = string.Empty;
    }
}




-----------------------------------------------------------------------




–ü–ê–ü–ö–ê Services


====================
FirebaseService.cs
====================


using Firebase.Database;
using Firebase.Database.Query;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using TrackingApp.Server.Config;
using TrackingApp.Server.Models;

namespace TrackingApp.Server.Services
{
    public class FirebaseService
    {
        private readonly FirebaseClient _firebase;

        public FirebaseService()
        {
            _firebase = FirebaseConfig.GetClient();
        }

        public async Task InitializeDefaultTripsAsync()
        {
            try
            {
                var existingTrips = await GetPredefinedTripsAsync();

                if (!existingTrips.Any())
                {
                    var lvivTrip = new PredefinedTrip
                    {
                        Id = Guid.NewGuid().ToString(),
                        Name = "–õ—å–≤—ñ–≤ - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç",
                        Description = "–Ü—Å—Ç–æ—Ä–∏—á–Ω–∏–π —Ü–µ–Ω—Ç—Ä –õ—å–≤–æ–≤–∞",
                        Duration = "3 –≥–æ–¥–∏–Ω–∏",
                        BreakSchedule = "–ü–µ—Ä–µ—Ä–≤–∞ –∑ 12:00 –¥–æ 13:00",
                        RestPlaces = new List<string> { "–ü–∞—Ä–∫ –®–µ–≤—á–µ–Ω–∫–∞", "–ö–∞—Ñ–µ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–µ" },
                        PointsOfInterest = new List<string> { "–õ—å–≤—ñ–≤—Å—å–∫–∏–π –æ–ø–µ—Ä–Ω–∏–π —Ç–µ–∞—Ç—Ä", "–†–∏–Ω–æ–∫" },
                        Route = new List<Location>
                        {
                            new Location(49.842957, 24.031111),
                            new Location(49.844000, 24.032500),
                            new Location(49.845500, 24.034000),
                            new Location(49.847000, 24.035500),
                            new Location(49.848500, 24.037000)
                        },
                        IsActive = false
                    };

                    await SavePredefinedTripAsync(lvivTrip);

                    var carpathiansTrip = new PredefinedTrip
                    {
                        Id = Guid.NewGuid().ToString(),
                        Name = "–ö–∞—Ä–ø–∞—Ç–∏ - –ì—ñ—Ä—Å—å–∫–∏–π –º–∞—Ä—à—Ä—É—Ç",
                        Description = "–ì—ñ—Ä—Å—å–∫–∞ –ø—Ä–æ–≥—É–ª—è–Ω–∫–∞ –ö–∞—Ä–ø–∞—Ç–∞–º–∏",
                        Duration = "6 –≥–æ–¥–∏–Ω",
                        BreakSchedule = "–ü–µ—Ä–µ—Ä–≤–∞ –∑ 13:00 –¥–æ 14:00",
                        RestPlaces = new List<string> { "–ì—ñ—Ä—Å—å–∫–∏–π –ø—Ä–∏—Ç—É–ª–æ–∫", "–°–º–æ—Ç—Ä–æ–≤–∞ –ø–ª–æ—â–∞" },
                        PointsOfInterest = new List<string> { "–ì–æ–≤–µ—Ä–ª–∞", "–ü—ñ–ø –Ü–≤–∞–Ω" },
                        Route = new List<Location>
                        {
                            new Location(48.922633, 22.573900),
                            new Location(48.925000, 22.575000),
                            new Location(48.927500, 22.577500),
                            new Location(48.930000, 22.580000),
                            new Location(48.932000, 22.582000)
                        },
                        IsActive = false
                    };

                    await SavePredefinedTripAsync(carpathiansTrip);

                    var bukovelTrip = new PredefinedTrip
                    {
                        Id = Guid.NewGuid().ToString(),
                        Name = "–ë—É–∫–æ–≤–µ–ª—å - –õ–∏–∂–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç",
                        Description = "–õ–∏–∂–Ω—ñ —Ç—Ä–∞—Å–∏ –ë—É–∫–æ–≤–µ–ª—è",
                        Duration = "4 –≥–æ–¥–∏–Ω–∏",
                        BreakSchedule = "–ü–µ—Ä–µ—Ä–≤–∞ –∑ 12:30 –¥–æ 13:30",
                        RestPlaces = new List<string> { "–õ–∏–∂–Ω–∞ –±–∞–∑–∞", "–ì—ñ—Ä—Å—å–∫–∏–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω" },
                        PointsOfInterest = new List<string> { "–õ–∏–∂–Ω—ñ —Ç—Ä–∞—Å–∏", "–ö–∞–Ω–∞—Ç–Ω–∞ –¥–æ—Ä–æ–≥–∞" },
                        Route = new List<Location>
                        {
                            new Location(48.354600, 24.412700),
                            new Location(48.356000, 24.414000),
                            new Location(48.357500, 24.416500),
                            new Location(48.359000, 24.418000),
                            new Location(48.360500, 24.420000)
                        },
                        IsActive = false
                    };

                    await SavePredefinedTripAsync(bukovelTrip);
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –º–∞—Ä—à—Ä—É—Ç—ñ–≤: {ex.Message}");
            }
        }

        public async Task<TripPlan> GetTripPlanAsync(string tripId)
        {
            try
            {
                var tripPlans = await _firebase
                    .Child("trip_plans")
                    .OnceAsync<TripPlan>();

                var plan = tripPlans
                    .Select(p =>
                    {
                        p.Object.Id = p.Key;
                        return p.Object;
                    })
                    .FirstOrDefault(p => p.TripId == tripId);

                return plan ?? new TripPlan { TripId = tripId };
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–ª–∞–Ω—É –ø–æ–¥–æ—Ä–æ–∂—ñ: {ex.Message}");
                return new TripPlan { TripId = tripId };
            }
        }

        public async Task<bool> SaveTripPlanAsync(TripPlan plan)
        {
            try
            {
                plan.LastUpdated = DateTime.UtcNow;

                var existingPlans = await _firebase
                    .Child("trip_plans")
                    .OnceAsync<TripPlan>();

                var existingPlan = existingPlans
                    .FirstOrDefault(p => p.Object.TripId == plan.TripId);

                if (existingPlan != null)
                {
                    await _firebase
                        .Child("trip_plans")
                        .Child(existingPlan.Key)
                        .PutAsync(plan);
                }
                else
                {
                    await _firebase
                        .Child("trip_plans")
                        .PostAsync(plan);
                }

                return true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–ª–∞–Ω—É –ø–æ–¥–æ—Ä–æ–∂—ñ: {ex.Message}");
                return false;
            }
        }

        public async Task<List<User>> GetUsersAsync()
        {
            try
            {
                var users = await _firebase
                    .Child("users")
                    .OnceAsync<User>();

                var result = users.Select(u =>
                {
                    u.Object.Id = u.Key;
                    return u.Object;
                }).ToList();

                return result;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: {ex.Message}");
                return new List<User>();
            }
        }

        public async Task<bool> CreateUserAsync(User user)
        {
            try
            {
                user.LastUpdated = DateTime.UtcNow;

                if (string.IsNullOrEmpty(user.Id) || user.Id == Guid.Empty.ToString())
                {
                    user.Id = Guid.NewGuid().ToString();
                }

                await _firebase
                    .Child("users")
                    .Child(user.Id)
                    .PutAsync(user);

                return true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {ex.Message}");
                return false;
            }
        }

        public async Task<bool> AddOrUpdateUserAsync(User user)
        {
            try
            {
                user.LastUpdated = DateTime.UtcNow;

                if (string.IsNullOrEmpty(user.Id) || user.Id == Guid.Empty.ToString())
                {
                    var result = await _firebase
                        .Child("users")
                        .PostAsync(user);

                    user.Id = result.Key;
                }
                else
                {
                    await _firebase
                        .Child("users")
                        .Child(user.Id)
                        .PutAsync(user);
                }

                return true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {ex.Message}");
                return false;
            }
        }

        public async Task<bool> UpdateUserLocationAsync(string userId, Location location)
        {
            try
            {
                var user = await GetUserAsync(userId);
                if (user == null) return false;

                user.CurrentLocation = location;
                user.LastUpdated = DateTime.UtcNow;

                await AddOrUpdateUserAsync(user);

                return true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ª–æ–∫–∞—Ü—ñ—ó: {ex.Message}");
                return false;
            }
        }

        private async Task<User> GetUserAsync(string userId)
        {
            try
            {
                var user = await _firebase
                    .Child("users")
                    .Child(userId)
                    .OnceSingleAsync<User>();

                if (user != null)
                    user.Id = userId;

                return user;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {ex.Message}");
                return null;
            }
        }

        public async Task<Trip> GetActiveTripAsync()
        {
            try
            {
                var predefinedTrips = await GetPredefinedTripsAsync();
                var activeTrip = predefinedTrips.FirstOrDefault(t => t.IsActive);

                if (activeTrip != null)
                {
                    var tripPlan = await GetTripPlanAsync(activeTrip.Id);

                    var trip = new Trip
                    {
                        TripName = activeTrip.Name,
                        Route = activeTrip.Route,
                        Duration = string.IsNullOrEmpty(tripPlan.Duration) ? activeTrip.Duration : tripPlan.Duration,
                        BreakSchedule = string.IsNullOrEmpty(tripPlan.BreakSchedule) ? activeTrip.BreakSchedule : tripPlan.BreakSchedule,
                        RestPlaces = tripPlan.RestPlaces.Any() ? tripPlan.RestPlaces : activeTrip.RestPlaces,
                        PointsOfInterest = tripPlan.PointsOfInterest.Any() ? tripPlan.PointsOfInterest : activeTrip.PointsOfInterest,
                        IsActive = true,
                        CreatedAt = activeTrip.CreatedAt
                    };

                    return trip;
                }

                return new Trip();
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç—É: {ex.Message}");
                return new Trip();
            }
        }

        public async Task<bool> SavePredefinedTripAsync(PredefinedTrip trip)
        {
            try
            {
                trip.CreatedAt = DateTime.UtcNow;

                await _firebase
                    .Child("predefined_trips")
                    .Child(trip.Id)
                    .PutAsync(trip);

                return true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É: {ex.Message}");
                return false;
            }
        }

        public async Task<List<PredefinedTrip>> GetPredefinedTripsAsync()
        {
            try
            {
                var trips = await _firebase
                    .Child("predefined_trips")
                    .OnceAsync<PredefinedTrip>();

                var result = trips.Select(t =>
                {
                    t.Object.Id = t.Key;
                    return t.Object;
                }).ToList();

                return result;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤: {ex.Message}");
                return new List<PredefinedTrip>();
            }
        }

        public async Task<bool> SetActiveTripAsync(string tripId)
        {
            try
            {
                var predefinedTrips = await GetPredefinedTripsAsync();

                foreach (var trip in predefinedTrips)
                {
                    if (trip.IsActive && trip.Id != tripId)
                    {
                        trip.IsActive = false;
                        await _firebase
                            .Child("predefined_trips")
                            .Child(trip.Id)
                            .PutAsync(trip);
                    }
                }

                var selectedTrip = predefinedTrips.FirstOrDefault(t => t.Id == tripId);
                if (selectedTrip != null)
                {
                    selectedTrip.IsActive = true;
                    await _firebase
                        .Child("predefined_trips")
                        .Child(selectedTrip.Id)
                        .PutAsync(selectedTrip);

                    return true;
                }

                return false;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç—É: {ex.Message}");
                return false;
            }
        }

        public async Task<List<Notification>> GetNotificationsAsync(int limit = 50)
        {
            try
            {
                var notifications = await _firebase
                    .Child("notifications")
                    .OrderByKey()
                    .LimitToLast(limit)
                    .OnceAsync<Notification>();

                var result = notifications
                    .Select(n => n.Object)
                    .OrderByDescending(n => n.Time)
                    .ToList();

                return result;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å: {ex.Message}");
                return new List<Notification>();
            }
        }

        public async Task<bool> AddNotificationAsync(Notification notification)
        {
            try
            {
                await _firebase
                    .Child("notifications")
                    .PostAsync(notification);

                return true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è: {ex.Message}");
                return false;
            }
        }

        public async Task<List<Feedback>> GetFeedbacksAsync(int limit = 50)
        {
            try
            {
                var feedbacks = await _firebase
                    .Child("feedbacks")
                    .OrderByKey()
                    .LimitToLast(limit)
                    .OnceAsync<Feedback>();

                var result = feedbacks
                    .Select(f =>
                    {
                        f.Object.Id = f.Key;
                        return f.Object;
                    })
                    .OrderByDescending(f => f.CreatedAt)
                    .ToList();

                return result;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—ñ–¥–≥—É–∫—ñ–≤: {ex.Message}");
                return new List<Feedback>();
            }
        }

        public async Task<bool> AddFeedbackAsync(Feedback feedback)
        {
            try
            {
                if (string.IsNullOrEmpty(feedback.Id) || feedback.Id == Guid.Empty.ToString())
                {
                    feedback.Id = Guid.NewGuid().ToString();
                }

                feedback.CreatedAt = DateTime.UtcNow;

                await _firebase
                    .Child("feedbacks")
                    .Child(feedback.Id)
                    .PutAsync(feedback);

                return true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤—ñ–¥–≥—É–∫—É: {ex.Message}");
                return false;
            }
        }

        public async Task<Dictionary<string, object>> GetStatisticsAsync()
        {
            try
            {
                var users = await GetUsersAsync();
                var notifications = await GetNotificationsAsync();
                var trip = await GetActiveTripAsync();
                var feedbacks = await GetFeedbacksAsync();

                var averageRating = feedbacks.Any() ? Math.Round(feedbacks.Average(f => f.Rating), 1) : 0;

                return new Dictionary<string, object>
                {
                    ["totalUsers"] = users.Count,
                    ["activeUsers"] = users.Count(u => u.LastUpdated > DateTime.UtcNow.AddHours(-1)),
                    ["totalNotifications"] = notifications.Count,
                    ["totalFeedbacks"] = feedbacks.Count,
                    ["averageRating"] = averageRating,
                    ["routePoints"] = trip.Route.Count,
                    ["leaders"] = users.Count(u => u.IsLeader)
                };
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: {ex.Message}");
                return new Dictionary<string, object>();
            }
        }

        public async Task<bool> TestConnectionAsync()
        {
            try
            {
                var testData = new { test = "connection", timestamp = DateTime.UtcNow };
                await _firebase
                    .Child("test_connection")
                    .Child(Guid.NewGuid().ToString())
                    .PutAsync(testData);

                return true;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Firebase: {ex.Message}");
                return false;
            }
        }
    }
}



-------------------------------------------------------------------------


–ü–ê–ü–ö–ê TcpServer


=========================
FirebaseTcpServer.cs
=======================



using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Text.Json;
using System.Threading.Tasks;
using TrackingApp.Server.Models;
using TrackingApp.Server.Services;
using TrackingApp.Server.Config;

namespace TrackingApp.Server.TcpServer
{
    public class FirebaseTcpServer
    {
        private readonly TcpListener _listener;
        private readonly FirebaseService _firebaseService;
        private bool _isRunning;

        public FirebaseTcpServer()
        {
            _listener = new TcpListener(IPAddress.Any, ServerConfig.Port);
            _firebaseService = new FirebaseService();
        }

        public void Start()
        {
            _isRunning = true;
            _listener.Start();

            _ = Task.Run(async () =>
            {
                await Task.Delay(500);
                await _firebaseService.InitializeDefaultTripsAsync();
            });

            Task.Run(ListenForClients);
        }

        public void Stop()
        {
            _isRunning = false;
            _listener?.Stop();
        }

        private async Task ListenForClients()
        {
            while (_isRunning)
            {
                try
                {
                    var client = await _listener.AcceptTcpClientAsync();
                    _ = Task.Run(() => HandleClient(client));
                }
                catch (ObjectDisposedException)
                {
                    break;
                }
                catch (Exception ex)
                {
                    if (_isRunning)
                        Console.WriteLine($"‚ùå {ex.Message}");
                }
            }
        }

        private async Task HandleClient(TcpClient client)
        {
            try
            {
                using (client)
                using (var stream = client.GetStream())
                {
                    var buffer = new byte[ServerConfig.BufferSize];
                    var messageBuilder = new StringBuilder();

                    while (client.Connected && _isRunning)
                    {
                        var bytesRead = await stream.ReadAsync(buffer, 0, buffer.Length);
                        if (bytesRead == 0) break;

                        var receivedData = Encoding.UTF8.GetString(buffer, 0, bytesRead);
                        messageBuilder.Append(receivedData);

                        var message = messageBuilder.ToString();

                        if (message.Contains("}"))
                        {
                            try
                            {
                                var cleanMessage = message.Trim();
                                cleanMessage = cleanMessage.TrimStart('\0', '\uFEFF', '\u200B');

                                if (!string.IsNullOrWhiteSpace(cleanMessage) &&
                                    cleanMessage.StartsWith("{") && cleanMessage.EndsWith("}"))
                                {
                                    var response = await ProcessRequest(cleanMessage);
                                    var responseJson = JsonSerializer.Serialize(response, new JsonSerializerOptions
                                    {
                                        PropertyNamingPolicy = JsonNamingPolicy.CamelCase
                                    }) + "\n";

                                    var responseBytes = Encoding.UTF8.GetBytes(responseJson);
                                    await stream.WriteAsync(responseBytes, 0, responseBytes.Length);
                                }

                                messageBuilder.Clear();
                            }
                            catch (Exception ex)
                            {
                                Console.WriteLine($"‚ùå {ex.Message}");
                                messageBuilder.Clear();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå {ex.Message}");
            }
            finally
            {
                Console.WriteLine("‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
            }
        }

        private async Task<ApiResponse<object>> ProcessRequest(string requestJson)
        {
            try
            {
                var request = JsonSerializer.Deserialize<ApiRequest>(requestJson, new JsonSerializerOptions
                {
                    PropertyNameCaseInsensitive = true
                });

                if (request == null)
                    return ApiResponse<object>.ErrorResponse("–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Ç—É");

                Console.WriteLine($"üîß {request.Command}");

                var response = request.Command?.ToLower() switch
                {
                    "ping" => await HandlePing(),
                    "get_users" => await HandleGetUsers(),
                    "get_active_trip" => await HandleGetActiveTrip(),
                    "get_notifications" => await HandleGetNotifications(),
                    "update_location" => await HandleUpdateLocation(request.Data),
                    "add_notification" => await HandleAddNotification(request.Data),
                    "get_statistics" => await HandleGetStatistics(),
                    "register_user" => await HandleRegisterUser(request.Data),
                    "add_feedback" => await HandleAddFeedback(request.Data),
                    "get_feedbacks" => await HandleGetFeedbacks(),
                    "get_predefined_trips" => await HandleGetPredefinedTrips(),
                    "set_active_trip" => await HandleSetActiveTrip(request.Data),
                    "update_trip_plan" => await HandleUpdateTripPlan(request.Data),
                    "save_predefined_trip" => await HandleSavePredefinedTrip(request.Data),
                    _ => ApiResponse<object>.ErrorResponse($"–ù–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞: {request.Command}")
                };

                // –î–æ–¥–∞—î–º–æ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫ –ø—ñ—Å–ª—è –≤–∞–∂–ª–∏–≤–∏—Ö –∫–æ–º–∞–Ω–¥
                if (request.Command?.ToLower() is "add_feedback" or "set_active_trip" or "update_trip_plan" or "save_predefined_trip")
                {
                    Console.WriteLine("‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
                }

                return response;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå {ex.Message}");
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandlePing()
        {
            try
            {
                var testData = new
                {
                    message = "–°–µ—Ä–≤–µ—Ä –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ",
                    timestamp = DateTime.UtcNow,
                    serverVersion = "1.0",
                    firebaseConnected = true
                };

                return ApiResponse<object>.SuccessResponse(testData, "Ping —É—Å–ø—ñ—à–Ω–∏–π");
            }
            catch (Exception ex)
            {
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleGetUsers()
        {
            try
            {
                var users = await _firebaseService.GetUsersAsync();
                return ApiResponse<object>.SuccessResponse(users, $"–û—Ç—Ä–∏–º–∞–Ω–æ {users.Count} –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤");
            }
            catch (Exception ex)
            {
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleGetActiveTrip()
        {
            try
            {
                var trip = await _firebaseService.GetActiveTripAsync();
                return ApiResponse<object>.SuccessResponse(trip, "–ê–∫—Ç–∏–≤–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç –æ—Ç—Ä–∏–º–∞–Ω–æ");
            }
            catch (Exception ex)
            {
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleGetNotifications()
        {
            try
            {
                var notifications = await _firebaseService.GetNotificationsAsync();
                return ApiResponse<object>.SuccessResponse(notifications, $"–û—Ç—Ä–∏–º–∞–Ω–æ {notifications.Count} —Å–ø–æ–≤—ñ—â–µ–Ω—å");
            }
            catch (Exception ex)
            {
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleUpdateLocation(object data)
        {
            try
            {
                var locationData = JsonSerializer.Deserialize<LocationUpdateData>(
                    JsonSerializer.Serialize(data),
                    new JsonSerializerOptions { PropertyNameCaseInsensitive = true });

                if (locationData == null || string.IsNullOrEmpty(locationData.UserId))
                    return ApiResponse<object>.ErrorResponse("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ –ª–æ–∫–∞—Ü—ñ—ó");

                var success = await _firebaseService.UpdateUserLocationAsync(
                    locationData.UserId,
                    locationData.Location);

                return success
                    ? ApiResponse<object>.SuccessResponse(true, "–õ–æ–∫–∞—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–∞")
                    : ApiResponse<object>.ErrorResponse("–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è");
            }
            catch (Exception ex)
            {
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleAddNotification(object data)
        {
            try
            {
                var notificationData = JsonSerializer.Deserialize<NotificationData>(
                    JsonSerializer.Serialize(data),
                    new JsonSerializerOptions { PropertyNameCaseInsensitive = true });

                if (notificationData == null || string.IsNullOrEmpty(notificationData.Message))
                    return ApiResponse<object>.ErrorResponse("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è");

                var notification = new Notification
                {
                    Message = notificationData.Message,
                    UserId = notificationData.UserId,
                    UserName = notificationData.UserName,
                    Time = DateTime.UtcNow
                };

                var success = await _firebaseService.AddNotificationAsync(notification);

                return success
                    ? ApiResponse<object>.SuccessResponse(true, "–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –¥–æ–¥–∞–Ω–æ")
                    : ApiResponse<object>.ErrorResponse("–ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è");
            }
            catch (Exception ex)
            {
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleGetStatistics()
        {
            try
            {
                var statistics = await _firebaseService.GetStatisticsAsync();
                return ApiResponse<object>.SuccessResponse(statistics, "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–∞");
            }
            catch (Exception ex)
            {
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleRegisterUser(object data)
        {
            try
            {
                var userData = JsonSerializer.Deserialize<UserRegistrationData>(
                    JsonSerializer.Serialize(data),
                    new JsonSerializerOptions { PropertyNameCaseInsensitive = true });

                if (userData == null || string.IsNullOrEmpty(userData.Name) || string.IsNullOrEmpty(userData.Password))
                    return ApiResponse<object>.ErrorResponse("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó");

                var existingUsers = await _firebaseService.GetUsersAsync();
                if (existingUsers.Any(u => u.Name == userData.Name))
                {
                    return ApiResponse<object>.ErrorResponse("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ —ñ—Å–Ω—É—î");
                }

                var newUser = new User
                {
                    Id = Guid.NewGuid().ToString(),
                    Name = userData.Name,
                    Email = userData.Email,
                    Password = userData.Password,
                    IsLeader = userData.IsLeader,
                    TripType = userData.TripType,
                    CurrentLocation = new Location(49.842957, 24.031111),
                    Status = UserStatus.None,
                    LastUpdated = DateTime.UtcNow
                };

                var success = await _firebaseService.CreateUserAsync(newUser);

                if (success)
                {
                    await _firebaseService.AddNotificationAsync(new Notification
                    {
                        Message = $"–ù–æ–≤–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á: {newUser.Name}",
                        UserId = newUser.Id,
                        UserName = "System",
                        Time = DateTime.UtcNow
                    });

                    return ApiResponse<object>.SuccessResponse(newUser, "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ");
                }
                else
                {
                    return ApiResponse<object>.ErrorResponse("–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó");
                }
            }
            catch (Exception ex)
            {
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleAddFeedback(object data)
        {
            try
            {
                var feedbackData = JsonSerializer.Deserialize<FeedbackData>(
                    JsonSerializer.Serialize(data),
                    new JsonSerializerOptions { PropertyNameCaseInsensitive = true });

                if (feedbackData == null || string.IsNullOrEmpty(feedbackData.Message))
                    return ApiResponse<object>.ErrorResponse("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ –≤—ñ–¥–≥—É–∫—É");

                var feedback = new Feedback
                {
                    UserId = feedbackData.UserId,
                    UserName = feedbackData.UserName,
                    Message = feedbackData.Message,
                    Rating = feedbackData.Rating,
                    TripName = feedbackData.TripName ?? "–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–¥–æ—Ä–æ–∂"
                };

                var success = await _firebaseService.AddFeedbackAsync(feedback);

                Console.WriteLine($"‚≠ê {feedbackData.UserName} ({feedbackData.Rating}/5)");

                return success
                    ? ApiResponse<object>.SuccessResponse(true, "–í—ñ–¥–≥—É–∫ –¥–æ–¥–∞–Ω–æ")
                    : ApiResponse<object>.ErrorResponse("–ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤—ñ–¥–≥—É–∫—É");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–≥—É–∫—É: {ex.Message}");
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleGetFeedbacks()
        {
            try
            {
                var feedbacks = await _firebaseService.GetFeedbacksAsync();
                return ApiResponse<object>.SuccessResponse(feedbacks, $"–û—Ç—Ä–∏–º–∞–Ω–æ {feedbacks.Count} –≤—ñ–¥–≥—É–∫—ñ–≤");
            }
            catch (Exception ex)
            {
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleGetPredefinedTrips()
        {
            try
            {
                var trips = await _firebaseService.GetPredefinedTripsAsync();
                return ApiResponse<object>.SuccessResponse(trips, $"–û—Ç—Ä–∏–º–∞–Ω–æ {trips.Count} –º–∞—Ä—à—Ä—É—Ç—ñ–≤");
            }
            catch (Exception ex)
            {
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleSetActiveTrip(object data)
        {
            try
            {
                var tripData = JsonSerializer.Deserialize<ActiveTripData>(
                    JsonSerializer.Serialize(data),
                    new JsonSerializerOptions { PropertyNameCaseInsensitive = true });

                if (tripData == null || string.IsNullOrEmpty(tripData.TripId))
                    return ApiResponse<object>.ErrorResponse("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ –º–∞—Ä—à—Ä—É—Ç—É");

                var success = await _firebaseService.SetActiveTripAsync(tripData.TripId);

                if (success)
                {
                    var trips = await _firebaseService.GetPredefinedTripsAsync();
                    var trip = trips.FirstOrDefault(t => t.Id == tripData.TripId);
                    if (trip != null)
                    {
                        Console.WriteLine($"üîÑ –ê–∫—Ç–∏–≤–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç: {trip.Name}");
                    }
                }

                return success
                    ? ApiResponse<object>.SuccessResponse(true, "–ê–∫—Ç–∏–≤–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")
                    : ApiResponse<object>.ErrorResponse("–ü–æ–º–∏–ª–∫–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –º–∞—Ä—à—Ä—É—Ç—É: {ex.Message}");
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleUpdateTripPlan(object data)
        {
            try
            {
                var planData = JsonSerializer.Deserialize<TripPlanData>(
                    JsonSerializer.Serialize(data),
                    new JsonSerializerOptions { PropertyNameCaseInsensitive = true });

                if (planData == null || string.IsNullOrEmpty(planData.TripId))
                    return ApiResponse<object>.ErrorResponse("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ –ø–ª–∞–Ω—É –ø–æ–¥–æ—Ä–æ–∂—ñ");

                var tripPlan = new TripPlan
                {
                    TripId = planData.TripId,
                    Duration = planData.Duration,
                    BreakSchedule = planData.BreakSchedule,
                    RestPlaces = planData.RestPlaces ?? new List<string>(),
                    PointsOfInterest = planData.PointsOfInterest ?? new List<string>(),
                    UpdatedBy = planData.UpdatedBy
                };

                var success = await _firebaseService.SaveTripPlanAsync(tripPlan);

                if (success)
                {
                    Console.WriteLine($"üìù –û–Ω–æ–≤–ª–µ–Ω–æ –ø–ª–∞–Ω: {planData.UpdatedBy}");
                }

                return success
                    ? ApiResponse<object>.SuccessResponse(true, "–ü–ª–∞–Ω –ø–æ–¥–æ—Ä–æ–∂—ñ –æ–Ω–æ–≤–ª–µ–Ω–æ")
                    : ApiResponse<object>.ErrorResponse("–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–ª–∞–Ω—É –ø–æ–¥–æ—Ä–æ–∂—ñ");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–ª–∞–Ω—É: {ex.Message}");
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private async Task<ApiResponse<object>> HandleSavePredefinedTrip(object data)
        {
            try
            {
                var tripData = JsonSerializer.Deserialize<PredefinedTrip>(
                    JsonSerializer.Serialize(data),
                    new JsonSerializerOptions { PropertyNameCaseInsensitive = true });

                if (tripData == null || string.IsNullOrEmpty(tripData.Name))
                    return ApiResponse<object>.ErrorResponse("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ –º–∞—Ä—à—Ä—É—Ç—É");

                var success = await _firebaseService.SavePredefinedTripAsync(tripData);

                if (success)
                {
                    Console.WriteLine($"üíæ –ù–æ–≤–∏–π –º–∞—Ä—à—Ä—É—Ç: {tripData.Name}");
                }

                return success
                    ? ApiResponse<object>.SuccessResponse(true, "–ú–∞—Ä—à—Ä—É—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–æ")
                    : ApiResponse<object>.ErrorResponse("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: {ex.Message}");
                return ApiResponse<object>.ErrorResponse($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }
    }

    // –ú–æ–¥–µ–ª—ñ –¥–ª—è –∑–∞–ø–∏—Ç—ñ–≤
    public class TripPlanData
    {
        public string TripId { get; set; } = string.Empty;
        public string Duration { get; set; } = string.Empty;
        public string BreakSchedule { get; set; } = string.Empty;
        public List<string> RestPlaces { get; set; } = new List<string>();
        public List<string> PointsOfInterest { get; set; } = new List<string>();
        public string UpdatedBy { get; set; } = string.Empty;
    }

    public class ApiRequest
    {
        public string Command { get; set; }
        public object Data { get; set; }
    }

    public class LocationUpdateData
    {
        public string UserId { get; set; }
        public Location Location { get; set; }
    }

    public class NotificationData
    {
        public string Message { get; set; }
        public string UserId { get; set; }
        public string UserName { get; set; }
    }

    public class UserRegistrationData
    {
        public string Name { get; set; }
        public string Email { get; set; }
        public string Password { get; set; }
        public bool IsLeader { get; set; }
        public TripType TripType { get; set; }
    }

    public class FeedbackData
    {
        public string UserId { get; set; }
        public string UserName { get; set; }
        public string Message { get; set; }
        public int Rating { get; set; }
        public string TripName { get; set; }
    }

    public class ActiveTripData
    {
        public string TripId { get; set; } = string.Empty;
    }
}







--------------------------------------------------------------




=====================
Program.cs
=====================


using System;
using System.Threading;
using System.Threading.Tasks;
using TrackingApp.Server.Config;
using TrackingApp.Server.TcpServer;
using TrackingApp.Server.Services;
using TrackingApp.Server.Models;

namespace TrackingApp.Server
{
    class Program
    {
        private static FirebaseTcpServer _server;
        private static bool _isRunning = true;
        private static FirebaseService _firebaseService;
        private static bool _inRequestMenu = false;
        private static bool _firebaseConnected = false;

        static void Main(string[] args)
        {
            PrintHeader();

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
            ServerConfig.Initialize();
            FirebaseConfig.Initialize();
            _firebaseService = new FirebaseService();

            // –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
            _server = new FirebaseTcpServer();
            _server.Start();

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Firebase
            CheckFirebaseConnection();

            // –û—Å–Ω–æ–≤–Ω–∏–π —Ü–∏–∫–ª
            while (_isRunning)
            {
                if (!_inRequestMenu)
                {
                    ShowMainMenu();
                }

                Console.Write("> ");
                var input = Console.ReadLine()?.Trim().ToLower();

                if (_inRequestMenu)
                {
                    HandleRequestMenu(input);
                }
                else
                {
                    HandleMainMenu(input);
                }
            }

            StopServer();
        }

        private static void PrintHeader()
        {
            Console.Clear();
            PrintSeparator();
            Console.WriteLine("üöÄ –ó–∞–ø—É—Å–∫ TrackingApp Server");
            Console.WriteLine("üìç –ü–æ—Ä—Ç: 8888");
            Console.WriteLine("üìç –†–µ–∂–∏–º: –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤ —É Firebase");
            PrintSeparator();
            Console.WriteLine("‚úÖ –°–µ—Ä–≤–µ—Ä —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–æ —Ç–∞ –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏");
            PrintSeparator();
        }

        private static async void CheckFirebaseConnection()
        {
            try
            {
                _firebaseConnected = await _firebaseService.TestConnectionAsync();
            }
            catch (Exception ex)
            {
                _firebaseConnected = false;
                Console.WriteLine($"‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Firebase: {ex.Message}");
            }
        }

        private static void ShowMainMenu()
        {
            Console.WriteLine("\nüìã –û–°–ù–û–í–ù–ï –ú–ï–ù–Æ –°–ï–†–í–ï–†–ê:");
            Console.WriteLine("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
            Console.WriteLine($"‚îÇ –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞: üü¢ –ó–ê–ü–£–©–ï–ù–û                                   ‚îÇ");
            Console.WriteLine($"‚îÇ –ü–æ—Ä—Ç: {ServerConfig.Port,-51}     ‚îÇ");
            Console.WriteLine($"‚îÇ Firebase: {(_firebaseConnected ? "üü¢ –ü–Ü–î–ö–õ–Æ–ß–ï–ù–û" : "üî¥ –í–Ü–î–ö–õ–Æ–ß–ï–ù–û"),-45}       ‚îÇ");
            Console.WriteLine("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");
            Console.WriteLine("‚îÇ 1  - –ú–µ–Ω—é –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö                               ‚îÇ");
            Console.WriteLine("‚îÇ 2  - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Firebase (TestConnectionAsync)    ‚îÇ");
            Console.WriteLine("‚îÇ 3  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞                                       ‚îÇ");
            Console.WriteLine("‚îÇ 4  - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä                                     ‚îÇ");
            Console.WriteLine("‚îÇ q  - –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–æ–±–æ—Ç—É —Å–µ—Ä–≤–µ—Ä–∞                                 ‚îÇ");
            Console.WriteLine("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
        }

        private static void ShowRequestsMenu()
        {
            Console.WriteLine("\nüìä –ú–ï–ù–Æ –ó–ê–ü–ò–¢–Ü–í –î–û –ë–ê–ó–ò –î–ê–ù–ò–•:");
            Console.WriteLine($"‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
            Console.WriteLine($"‚îÇ –°—Ç–∞—Ç—É—Å Firebase: {(_firebaseConnected ? "üü¢ –ü–Ü–î–ö–õ–Æ–ß–ï–ù–û" : "üî¥ –í–Ü–î–ö–õ–Æ–ß–ï–ù–û"),-38}  ‚îÇ");
            Console.WriteLine("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");
            Console.WriteLine("‚îÇ 1  - –í—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ (GetUsersAsync)                     ‚îÇ");
            Console.WriteLine("‚îÇ 2  - –ü–æ—Ç–æ—á–Ω–∏–π –∞–∫—Ç–∏–≤–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç (GetActiveTripAsync)      ‚îÇ");
            Console.WriteLine("‚îÇ 3  - –û—Å—Ç–∞–Ω–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è (GetNotificationsAsync)          ‚îÇ");
            Console.WriteLine("‚îÇ 4  - –í—ñ–¥–≥—É–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (GetFeedbacksAsync)            ‚îÇ");
            Console.WriteLine("‚îÇ 5  - –í—Å—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏ (GetPredefinedTripsAsync)    ‚îÇ");
            Console.WriteLine("‚îÇ 6  - –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (GetUsersAsync) ‚îÇ");
            Console.WriteLine("‚îÇ 7  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º–∏ (GetStatisticsAsync)             ‚îÇ");
            Console.WriteLine("‚îÇ 8  - –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (DeleteUserAsync)              ‚îÇ");
            Console.WriteLine("‚îÇ b  - –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é                       ‚îÇ");
            Console.WriteLine("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
        }

        private static void HandleMainMenu(string input)
        {
            switch (input)
            {
                case "1":
                    _inRequestMenu = true;
                    Console.Clear();
                    PrintSeparator();
                    Console.WriteLine("üìä –ú–ï–ù–Æ –ó–ê–ü–ò–¢–Ü–í –î–û –ë–ê–ó–ò –î–ê–ù–ò–•");
                    PrintSeparator();
                    ShowRequestsMenu();
                    break;

                case "2":
                    TestConnection();
                    break;

                case "3":
                    ShowServerStatistics();
                    break;

                case "4":
                    RestartServer();
                    break;

                case "q":
                case "quit":
                    _isRunning = false;
                    break;

                case "":
                    break;

                default:
                    Console.WriteLine("‚ùå –ù–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
                    break;
            }
        }

        private static void HandleRequestMenu(string input)
        {
            switch (input)
            {
                case "1":
                    ShowAllUsers();
                    WaitForBack();
                    break;

                case "2":
                    ShowActiveTrip();
                    WaitForBack();
                    break;

                case "3":
                    ShowNotifications();
                    WaitForBack();
                    break;

                case "4":
                    ShowFeedbacks();
                    WaitForBack();
                    break;

                case "5":
                    ShowPredefinedTrips();
                    WaitForBack();
                    break;

                case "6":
                    ShowUserDetailsMenu();
                    break;

                case "7":
                    ShowStatistics();
                    WaitForBack();
                    break;

                case "8":
                    DeleteUserMenu();
                    break;

                case "b":
                case "back":
                    _inRequestMenu = false;
                    Console.Clear();
                    PrintSeparator();
                    Console.WriteLine("üîô –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é");
                    PrintSeparator();
                    break;

                case "":
                    break;

                default:
                    Console.WriteLine("‚ùå –ù–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
                    break;
            }
        }

        private static void WaitForBack()
        {
            Console.WriteLine("\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
            Console.WriteLine("–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å 'b' –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –º–µ–Ω—é –∑–∞–ø–∏—Ç—ñ–≤");
            var input = "";
            while (input != "b")
            {
                Console.Write("> ");
                input = Console.ReadLine()?.Trim().ToLower();
                if (input == "b")
                {
                    Console.Clear();
                    PrintSeparator();
                    Console.WriteLine("üìä –ú–ï–ù–Æ –ó–ê–ü–ò–¢–Ü–í –î–û –ë–ê–ó–ò –î–ê–ù–ò–•");
                    PrintSeparator();
                    ShowRequestsMenu();
                    break;
                }
            }
        }

        private static void ShowUserDetailsMenu()
        {
            Console.Write("\nüë§ –í–≤–µ–¥—ñ—Ç—å —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: ");
            var userName = Console.ReadLine()?.Trim();

            if (string.IsNullOrEmpty(userName))
            {
                Console.WriteLine("‚ùå –Ü–º'—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º");
                WaitForBack();
                return;
            }

            ShowUserDetails(userName);
            WaitForBack();
        }

        private static void DeleteUserMenu()
        {
            Console.Write("\nüóëÔ∏è –í–≤–µ–¥—ñ—Ç—å —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è: ");
            var userName = Console.ReadLine()?.Trim();

            if (string.IsNullOrEmpty(userName))
            {
                Console.WriteLine("‚ùå –Ü–º'—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º");
                WaitForBack();
                return;
            }

            DeleteUser(userName);
            WaitForBack();
        }

        private static void RestartServer()
        {
            Console.WriteLine("\nüîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞...");
            _server?.Stop();
            Thread.Sleep(1000);

            _server = new FirebaseTcpServer();
            _server.Start();

            CheckFirebaseConnection();

            Console.WriteLine("‚úÖ –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ");
            Thread.Sleep(1000);
            Console.Clear();
            PrintHeader();
        }

        // –ú–ï–¢–û–î–ò –î–õ–Ø –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø –î–ê–ù–ò–•

        private static async void ShowAllUsers()
        {
            try
            {
                Console.WriteLine("\nüë• –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –ö–û–†–ò–°–¢–£–í–ê–ß–Ü–í...");
                var users = await _firebaseService.GetUsersAsync();

                if (users.Any())
                {
                    Console.WriteLine($"\n‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ {users.Count} –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:");
                    Console.WriteLine("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
                    Console.WriteLine("‚îÇ ‚Ññ   ‚îÇ –Ü–º'—è             ‚îÇ Email                 ‚îÇ –õ—ñ–¥–µ—Ä    ‚îÇ");
                    Console.WriteLine("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");

                    for (int i = 0; i < users.Count; i++)
                    {
                        var user = users[i];
                        var leaderStatus = user.IsLeader ? "‚úÖ –¢–∞–∫" : "‚ùå –ù—ñ";

                        Console.WriteLine($"‚îÇ {i + 1,-3} ‚îÇ {user.Name,-16} ‚îÇ {user.Email,-21} ‚îÇ {leaderStatus,-7} ‚îÇ");
                    }
                    Console.WriteLine("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
                }
                else
                {
                    Console.WriteLine("‚ùå –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private static async void ShowActiveTrip()
        {
            try
            {
                Console.WriteLine("\nüó∫Ô∏è –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –ê–ö–¢–ò–í–ù–û–ì–û –ú–ê–†–®–†–£–¢–£...");
                var trip = await _firebaseService.GetActiveTripAsync();

                if (trip != null && !string.IsNullOrEmpty(trip.TripName))
                {
                    Console.WriteLine($"\n‚úÖ –ê–ö–¢–ò–í–ù–ò–ô –ú–ê–†–®–†–£–¢:");
                    Console.WriteLine($"‚îú‚îÄ –ù–∞–∑–≤–∞: {trip.TripName}");
                    Console.WriteLine($"‚îú‚îÄ –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å: {trip.Duration}");
                    Console.WriteLine($"‚îú‚îÄ –ü–µ—Ä–µ—Ä–≤–∏: {trip.BreakSchedule}");
                    Console.WriteLine($"‚îú‚îÄ –¢–æ—á–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É: {trip.Route.Count}");
                    Console.WriteLine($"‚îú‚îÄ –ú—ñ—Å—Ü—è –≤—ñ–¥–ø–æ—á–∏–Ω–∫—É: {string.Join(", ", trip.RestPlaces)}");
                    Console.WriteLine($"‚îî‚îÄ –¶—ñ–∫–∞–≤—ñ –º—ñ—Å—Ü—è: {string.Join(", ", trip.PointsOfInterest)}");
                }
                else
                {
                    Console.WriteLine("‚ùå –ê–∫—Ç–∏–≤–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private static async void ShowNotifications()
        {
            try
            {
                Console.WriteLine("\nüì¢ –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –°–ü–û–í–Ü–©–ï–ù–¨...");
                var notifications = await _firebaseService.GetNotificationsAsync(20);

                if (notifications.Any())
                {
                    Console.WriteLine($"\nüîî –û–°–¢–ê–ù–ù–Ü {notifications.Count} –°–ü–û–í–Ü–©–ï–ù–¨:");
                    foreach (var notification in notifications.Take(10))
                    {
                        Console.WriteLine($"‚îú‚îÄ [{notification.Time:HH:mm:ss}] {notification.UserName}: {notification.Message}");
                    }
                    if (notifications.Count > 10)
                    {
                        Console.WriteLine($"‚îî‚îÄ ... —ñ —â–µ {notifications.Count - 10} —Å–ø–æ–≤—ñ—â–µ–Ω—å");
                    }
                }
                else
                {
                    Console.WriteLine("‚ùå –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—ñ");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private static async void ShowFeedbacks()
        {
            try
            {
                Console.WriteLine("\n‚≠ê –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –í–Ü–î–ì–£–ö–Ü–í...");
                var feedbacks = await _firebaseService.GetFeedbacksAsync(20);

                if (feedbacks.Any())
                {
                    Console.WriteLine($"\nüìù –û–°–¢–ê–ù–ù–Ü {feedbacks.Count} –í–Ü–î–ì–£–ö–Ü–í:");
                    foreach (var feedback in feedbacks.Take(10))
                    {
                        var stars = new string('‚≠ê', feedback.Rating) + new string('‚òÜ', 5 - feedback.Rating);
                        Console.WriteLine($"‚îú‚îÄ {feedback.UserName} ({stars}): {feedback.Message}");
                    }
                    if (feedbacks.Count > 10)
                    {
                        Console.WriteLine($"‚îî‚îÄ ... —ñ —â–µ {feedbacks.Count - 10} –≤—ñ–¥–≥—É–∫—ñ–≤");
                    }
                }
                else
                {
                    Console.WriteLine("‚ùå –í—ñ–¥–≥—É–∫–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private static async void ShowUserDetails(string userName)
        {
            try
            {
                var users = await _firebaseService.GetUsersAsync();
                var user = users.FirstOrDefault(u => u.Name.Equals(userName, StringComparison.OrdinalIgnoreCase));

                if (user != null)
                {
                    Console.WriteLine($"\nüìã –î–ï–¢–ê–õ–¨–ù–ê –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø –ü–†–û –ö–û–†–ò–°–¢–£–í–ê–ß–ê:");
                    Console.WriteLine($"‚îú‚îÄ –Ü–º'—è: {user.Name}");
                    Console.WriteLine($"‚îú‚îÄ Email: {user.Email}");
                    Console.WriteLine($"‚îú‚îÄ –õ—ñ–¥–µ—Ä: {(user.IsLeader ? "‚úÖ –¢–∞–∫" : "‚ùå –ù—ñ")}");
                    Console.WriteLine($"‚îú‚îÄ –¢–∏–ø –ø–æ–¥–æ—Ä–æ–∂—ñ: {user.TripType}");
                    Console.WriteLine($"‚îî‚îÄ –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: {user.LastUpdated:dd.MM.yyyy HH:mm}");
                }
                else
                {
                    Console.WriteLine($"‚ùå –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ '{userName}' –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private static async void ShowPredefinedTrips()
        {
            try
            {
                Console.WriteLine("\nüó∫Ô∏è –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –ú–ê–†–®–†–£–¢–Ü–í...");
                var trips = await _firebaseService.GetPredefinedTripsAsync();

                if (trips.Any())
                {
                    Console.WriteLine($"\nüìå –ó–ù–ê–ô–î–ï–ù–û {trips.Count} –ú–ê–†–®–†–£–¢–Ü–í:");
                    foreach (var trip in trips)
                    {
                        var activeStatus = trip.IsActive ? "‚úÖ –ê–ö–¢–ò–í–ù–ò–ô" : "‚ùå –ù–ï–ê–ö–¢–ò–í–ù–ò–ô";
                        Console.WriteLine($"‚îú‚îÄ {trip.Name} ({activeStatus})");
                        Console.WriteLine($"‚îÇ  ‚îî‚îÄ {trip.Description}");
                    }
                }
                else
                {
                    Console.WriteLine("‚ùå –ú–∞—Ä—à—Ä—É—Ç–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private static async void ShowStatistics()
        {
            try
            {
                Console.WriteLine("\nüìä –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ò...");
                var stats = await _firebaseService.GetStatisticsAsync();

                if (stats.Any())
                {
                    Console.WriteLine("\nüìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–ò–°–¢–ï–ú–ò:");
                    Console.WriteLine("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
                    Console.WriteLine("‚îÇ –ü–∞—Ä–∞–º–µ—Ç—Ä                 ‚îÇ –ó–Ω–∞—á–µ–Ω–Ω—è ‚îÇ");
                    Console.WriteLine("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");
                    Console.WriteLine($"‚îÇ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤            ‚îÇ {stats["totalUsers"],-8} ‚îÇ");
                    Console.WriteLine($"‚îÇ –ê–∫—Ç–∏–≤–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤   ‚îÇ {stats["activeUsers"],-8} ‚îÇ");
                    Console.WriteLine($"‚îÇ –°–ø–æ–≤—ñ—â–µ–Ω—å               ‚îÇ {stats["totalNotifications"],-8} ‚îÇ");
                    Console.WriteLine($"‚îÇ –í—ñ–¥–≥—É–∫—ñ–≤                ‚îÇ {stats["totalFeedbacks"],-8} ‚îÇ");
                    Console.WriteLine($"‚îÇ –°–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–π—Ç–∏–Ω–≥        ‚îÇ {stats["averageRating"],-8} ‚îÇ");
                    Console.WriteLine($"‚îÇ –õ—ñ–¥–µ—Ä—ñ–≤                 ‚îÇ {stats["leaders"],-8} ‚îÇ");
                    Console.WriteLine("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
                }
                else
                {
                    Console.WriteLine("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }
        }

        private static async void DeleteUser(string userName)
        {
            try
            {
                Console.WriteLine($"\nüóëÔ∏è –°–ü–†–û–ë–ê –í–ò–î–ê–õ–ï–ù–ù–Ø –ö–û–†–ò–°–¢–£–í–ê–ß–ê: {userName}");

                // –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —á–∏ —ñ—Å–Ω—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
                var users = await _firebaseService.GetUsersAsync();
                var userToDelete = users.FirstOrDefault(u => u.Name.Equals(userName, StringComparison.OrdinalIgnoreCase));

                if (userToDelete == null)
                {
                    Console.WriteLine("‚ùå –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —Ç–∞–∫–∏–º —ñ–º–µ–Ω–µ–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ");
                    return;
                }

                Console.WriteLine($"\nüìã –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø –ü–†–û –ö–û–†–ò–°–¢–£–í–ê–ß–ê –î–õ–Ø –í–ò–î–ê–õ–ï–ù–ù–Ø:");
                Console.WriteLine($"‚îú‚îÄ –Ü–º'—è: {userToDelete.Name}");
                Console.WriteLine($"‚îú‚îÄ Email: {userToDelete.Email}");
                Console.WriteLine($"‚îú‚îÄ –õ—ñ–¥–µ—Ä: {(userToDelete.IsLeader ? "‚úÖ –¢–∞–∫" : "‚ùå –ù—ñ")}");
                Console.WriteLine($"‚îî‚îÄ –¢–∏–ø –ø–æ–¥–æ—Ä–æ–∂—ñ: {userToDelete.TripType}");

                Console.Write($"\n‚ùì –í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ {userToDelete.Name}? (y/n): ");
                var confirmation = Console.ReadLine()?.Trim().ToLower();

                if (confirmation == "y" || confirmation == "yes")
                {
                    // –¢—É—Ç –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                    // bool success = await _firebaseService.DeleteUserAsync(userToDelete.Id);

                    // –¢–∏–º—á–∞—Å–æ–≤–∞ —ñ–º—ñ—Ç–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
                    bool success = true;

                    if (success)
                    {
                        Console.WriteLine($"‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ {userToDelete.Name} —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ");
                    }
                    else
                    {
                        Console.WriteLine($"‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ {userToDelete.Name}");
                    }
                }
                else
                {
                    Console.WriteLine("‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {ex.Message}");
            }
        }

        private static void ShowServerStatistics()
        {
            Console.WriteLine("\nüñ•Ô∏è –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–ï–†–í–ï–†–ê:");
            Console.WriteLine("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
            Console.WriteLine("‚îÇ –ü–∞—Ä–∞–º–µ—Ç—Ä                 ‚îÇ –ó–Ω–∞—á–µ–Ω–Ω—è       ‚îÇ");
            Console.WriteLine("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");
            Console.WriteLine($"‚îÇ –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞            ‚îÇ {ServerConfig.Port,-14} ‚îÇ");
            Console.WriteLine($"‚îÇ –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞          ‚îÇ {"üü¢ –ó–∞–ø—É—â–µ–Ω–∏–π",-13}  ‚îÇ");
            Console.WriteLine($"‚îÇ Firebase                ‚îÇ {(_firebaseConnected ? "üü¢ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ" : "üî¥ –í—ñ–¥–∫–ª—é—á–µ–Ω–æ"),-14} ‚îÇ");
            Console.WriteLine("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");

            WaitForAnyKey();
        }

        private static async void TestConnection()
        {
            try
            {
                Console.WriteLine("\nüîó –ü–ï–†–ï–í–Ü–†–ö–ê –ó'–Ñ–î–ù–ê–ù–ù–Ø...");
                var isConnected = await _firebaseService.TestConnectionAsync();
                _firebaseConnected = isConnected;

                if (isConnected)
                {
                    Console.WriteLine("‚úÖ –ó'—î–¥–Ω–∞–Ω–Ω—è –∑ Firebase –ø—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ");
                }
                else
                {
                    Console.WriteLine("‚ùå –ü—Ä–æ–±–ª–µ–º–∏ –∑ –∑'—î–¥–Ω–∞–Ω–Ω—è–º Firebase");
                }
            }
            catch (Exception ex)
            {
                _firebaseConnected = false;
                Console.WriteLine($"‚ùå –ü–æ–º–∏–ª–∫–∞: {ex.Message}");
            }

            WaitForAnyKey();
        }

        private static void WaitForAnyKey()
        {
            Console.WriteLine("\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
            Console.WriteLine("–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –±—É–¥—å-—è–∫—É –∫–ª–∞–≤—ñ—à—É –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è...");
            Console.ReadKey();
            Console.Clear();
            PrintSeparator();
            Console.WriteLine("üîô –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é");
            PrintSeparator();
        }

        private static void StopServer()
        {
            PrintSeparator();
            Console.WriteLine("üõë –ó—É–ø–∏–Ω–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞...");
            _server?.Stop();

            Thread.Sleep(1000);
            Console.WriteLine("‚úÖ –°–µ—Ä–≤–µ—Ä –∑—É–ø–∏–Ω–µ–Ω–æ");
            PrintSeparator();
        }

        private static void PrintSeparator()
        {
            Console.WriteLine(new string('‚îÄ', 60));
        }
    }
}